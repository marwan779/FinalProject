@model InventoryManagementSystem.Models.ViewModels.CheckoutViewModel

@{
    ViewData["Title"] = "Checkout";
}

<div class="products-page">
    <!-- Page Header -->
    <div class="page-header">
        <h1><i class="fas fa-credit-card"></i> Checkout</h1>
        <p class="page-subtitle">Complete your order</p>
    </div>

    <div class="checkout-form">
        <div class="checkout-container">
            <!-- Checkout Form -->
            <div class="checkout-left">
                <!-- Shipping Information -->
                <div class="checkout-section">
                    <h3 class="section-title">
                        <i class="fas fa-shipping-fast"></i> Shipping Information
                    </h3>

                    <form asp-controller="Checkout" asp-action="ProcessOrder" method="post" id="checkout-form">
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="validation-summary"></div>

                        <div class="form-grid">
                            <!-- Full Name -->
                            <div class="form-group">
                                <label asp-for="ShippingFullName" class="form-label"></label>
                                <input asp-for="ShippingFullName" class="form-control" placeholder="Enter your full name" />
                                <span asp-validation-for="ShippingFullName" class="validation-message"></span>
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label asp-for="ShippingEmail" class="form-label"></label>
                                <input asp-for="ShippingEmail" class="form-control" placeholder="Enter your email" />
                                <span asp-validation-for="ShippingEmail" class="validation-message"></span>
                            </div>

                            <!-- Phone -->
                            <div class="form-group">
                                <label asp-for="ShippingPhone" class="form-label"></label>
                                <input asp-for="ShippingPhone" class="form-control" placeholder="Enter your phone number" />
                                <span asp-validation-for="ShippingPhone" class="validation-message"></span>
                            </div>

                            <!-- Address -->
                            <div class="form-group full-width">
                                <label asp-for="ShippingAddress" class="form-label"></label>
                                <textarea asp-for="ShippingAddress" class="form-control" rows="3" placeholder="Enter your complete shipping address"></textarea>
                                <span asp-validation-for="ShippingAddress" class="validation-message"></span>
                            </div>
                        </div>

                        <!-- Payment Methods -->
                        <div class="checkout-section">
                            <h3 class="section-title">
                                <i class="fas fa-money-bill-wave"></i> Payment Method
                            </h3>

                            <div class="payment-methods">
                                <!-- Cash on Delivery -->
                                <div class="payment-option">
                                    <input type="radio" asp-for="PaymentMethod" value="Cash" id="cash" checked />
                                    <label for="cash" class="payment-label">
                                        <i class="fas fa-money-bill"></i>
                                        <div class="payment-info">
                                            <strong>Cash on Delivery</strong>
                                            <small>Pay when you receive your order</small>
                                        </div>
                                    </label>
                                </div>

                                <!-- Instapay -->
                                <div class="payment-option">
                                    <input type="radio" asp-for="PaymentMethod" value="Instapay" id="instapay" />
                                    <label for="instapay" class="payment-label">
                                        <i class="fas fa-credit-card"></i>
                                        <div class="payment-info">
                                            <strong>Instapay</strong>
                                            <small>Pay securely with your bank card</small>
                                        </div>
                                    </label>
                                </div>

                                <!-- Wallet -->
                                <div class="payment-option">
                                    <input type="radio" asp-for="PaymentMethod" value="Wallet" id="wallet" />
                                    <label for="wallet" class="payment-label">
                                        <i class="fas fa-wallet"></i>
                                        <div class="payment-info">
                                            <strong>E-Wallet</strong>
                                            <small>Pay using your digital wallet</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <span asp-validation-for="PaymentMethod" class="validation-message"></span>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-actions">
                            <a asp-controller="Cart" asp-action="Index" class="btn btn-back">
                                <i class="fas fa-arrow-left"></i> Back to Cart
                            </a>
                            <button type="submit" class="btn btn-submit" id="submit-order">
                                <i class="fas fa-lock"></i> Complete Order - EGP @Model.CartTotal.ToString("N2")
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="checkout-right">
                <div class="order-summary-box">
                    <h3 class="summary-title">
                        <i class="fas fa-receipt"></i> Order Summary
                    </h3>

                    <!-- Order Items -->
                    <div class="summary-items">
                        @foreach (var item in Model.CartItems)
                        {
                            <div class="summary-item">
                                <div class="item-image">
                                    @if (!string.IsNullOrEmpty(item.ProductImage))
                                    {
                                        <img src="@item.ProductImage" alt="@item.ProductName" />
                                    }
                                    else
                                    {
                                        <div class="no-img">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    }
                                </div>
                                <div class="item-details">
                                    <h4 class="item-name">@item.ProductName</h4>
                                    <p class="item-quantity">Qty: @item.Quantity × EGP @item.UnitPrice.ToString("N2")</p>
                                </div>
                                <div class="item-total">EGP @item.TotalPrice.ToString("N2")</div>
                            </div>
                        }
                    </div>

                    <!-- Order Totals -->
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>EGP @Model.CartTotal.ToString("N2")</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping:</span>
                            <span class="free-shipping">Free</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-row summary-total">
                            <span>Total Amount:</span>
                            <span class="total-amount">EGP @Model.CartTotal.ToString("N2")</span>
                        </div>
                    </div>

                    <!-- Items Count -->
                    <div class="summary-info">
                        <p><i class="fas fa-box"></i> @Model.CartCount items in your order</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* ==================== CHECKOUT STYLES ==================== */
    .checkout-form {
        max-width: 1200px;
        margin: 0 auto;
    }

    .checkout-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 30px;
        align-items: start;
    }

    /* Left Side - Checkout Form */
    .checkout-left {
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    .checkout-section {
        background: var(--bg-overlay-dark);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 15px var(--shadow-light);
    }

    /* Form Styles */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .full-width {
        grid-column: 1 / -1;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-label {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 0.95rem;
        margin-bottom: 5px;
    }

    .form-control {
        background: var(--white);
        border: 2px solid var(--border-gray);
        border-radius: 6px;
        padding: 12px 15px;
        color: var(--text-primary);
        font-size: 1rem;
        transition: all 0.3s ease;
    }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

    textarea.form-control {
        resize: vertical;
        min-height: 80px;
    }

    /* Validation Styles */
    .validation-summary {
        background: rgba(244, 67, 54, 0.1);
        border: 1px solid var(--danger-color);
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
        color: var(--danger-color);
        font-size: 0.9rem;
    }

        .validation-summary ul {
            margin: 0;
            padding-left: 20px;
        }

    .validation-message {
        color: var(--danger-color);
        font-size: 0.85rem;
        font-weight: 500;
        margin-top: 5px;
        display: block;
    }

    /* Payment Methods */
    .payment-methods {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .payment-option {
        position: relative;
    }

        .payment-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

    .payment-label {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: var(--white);
        border: 2px solid var(--border-gray);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-primary);
    }

        .payment-label:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .payment-label i {
            font-size: 1.5rem;
            color: var(--primary-color);
            width: 30px;
            text-align: center;
        }

    .payment-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

        .payment-info strong {
            font-size: 1rem;
            color: var(--text-dark);
        }

        .payment-info small {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

    .payment-option input[type="radio"]:checked + .payment-label {
        border-color: var(--primary-color);
        background: rgba(76, 175, 80, 0.05);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
    }

    /* Form Actions */
    .form-actions {
        display: flex;
        gap: 15px;
        justify-content: space-between;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-gray);
    }

    .btn-back {
        background: var(--light-gray);
        color: var(--white);
        border: none;
        border-radius: 8px;
        padding: 15px 25px;
        font-weight: 600;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        flex: 1;
        justify-content: center;
    }

        .btn-back:hover {
            background: var(--medium-gray);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

    .btn-submit {
        background: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        padding: 15px 25px;
        font-weight: 600;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        flex: 2;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

        .btn-submit:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-submit:disabled {
            background: var(--light-gray);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }

    /* Right Side - Order Summary */
    .checkout-right {
        position: sticky;
        top: 20px;
    }

    .order-summary-box {
        background: var(--bg-overlay-dark);
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px var(--shadow-light);
        position: sticky;
        top: 20px;
    }

    .summary-title {
        color: var(--primary-color);
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
    }

    /* Summary Items */
    .summary-items {
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
    }

        .summary-items::-webkit-scrollbar {
            width: 6px;
        }

        .summary-items::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 3px;
        }

        .summary-items::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

    .summary-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-gray);
    }

        .summary-item:last-child {
            border-bottom: none;
        }

    .item-image {
        flex-shrink: 0;
    }

        .item-image img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--border-gray);
        }

    .no-img {
        width: 50px;
        height: 50px;
        background: var(--bg-light);
        border: 2px dashed var(--border-gray);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        font-size: 1.2rem;
    }

    .item-details {
        flex: 1;
        min-width: 0;
    }

    .item-name {
        color: var(--primary-color);
        font-size: 0.95rem;
        font-weight: 600;
        margin: 0 0 5px 0;
        line-height: 1.3;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .item-quantity {
        color: var(--primary-color);
        opacity: 0.8;
        font-size: 0.85rem;
        margin: 0;
    }

    .item-total {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 0.95rem;
        flex-shrink: 0;
    }

    /* Summary Totals */
    .summary-totals {
        margin: 25px 0;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        color: var(--primary-color);
    }

    .free-shipping {
        color: var(--success-color) !important;
        font-weight: 600;
    }

    .summary-divider {
        height: 1px;
        background: var(--border-gray);
        margin: 10px 0;
    }

    .summary-total {
        font-size: 1.2rem;
        font-weight: 700;
        padding-top: 10px;
        border-top: 2px solid var(--primary-color);
    }

    .total-amount {
        color: var(--primary-color);
        font-size: 1.4rem;
    }

    /* Summary Info */
    .summary-info {
        background: rgba(76, 175, 80, 0.1);
        border-radius: 6px;
        padding: 12px 15px;
        border-left: 4px solid var(--primary-color);
    }

        .summary-info p {
            color: var(--primary-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

    /* ==================== RESPONSIVE DESIGN ==================== */
    @@media (max-width: 1024px) {
        .checkout-container {
            grid-template-columns: 1fr;
            gap: 25px;
        }

        .checkout-right {
            position: static;
        }

        .order-summary-box {
            position: static;
        }
    }

    @@media (max-width: 768px) {
        .checkout-section {
            padding: 25px 20px;
        }

        .form-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .form-actions {
            flex-direction: column;
        }

        .btn-back,
        .btn-submit {
            flex: 1;
            width: 100%;
        }

        .order-summary-box {
            padding: 20px;
        }

        .summary-items {
            max-height: 300px;
        }
    }

    @@media (max-width: 480px) {
        .checkout-section {
            padding: 20px 15px;
        }

        .payment-label {
            padding: 15px;
        }

            .payment-label i {
                font-size: 1.3rem;
            }

        .summary-title {
            font-size: 1.1rem;
        }

        .summary-item {
            gap: 12px;
            padding: 12px 0;
        }

        .item-image img,
        .no-img {
            width: 40px;
            height: 40px;
        }

        .item-name {
            font-size: 0.9rem;
        }

        .item-total {
            font-size: 0.9rem;
        }

        .total-amount {
            font-size: 1.2rem;
        }

        .btn-submit {
            font-size: 1rem;
            padding: 12px 20px;
        }
    }

    /* Animation for form elements */
    .checkout-section {
        animation: slideInUp 0.5s ease;
    }

    .order-summary-box {
        animation: slideInUp 0.5s ease 0.1s both;
    }

    @@keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function () {
            // Form submission handling
            $('#checkout-form').on('submit', function (e) {
                const submitBtn = $('#submit-order');
                submitBtn.prop('disabled', true);
                submitBtn.html('<i class="fas fa-spinner fa-spin"></i> Processing...');

                // Allow form to submit normally
                return true;
            });

            // Payment method change
            $('input[name="PaymentMethod"]').change(function () {
                const selectedMethod = $('input[name="PaymentMethod"]:checked').val();
                updateSubmitButton(selectedMethod);
            });

            function updateSubmitButton(method) {
                const submitBtn = $('#submit-order');
                const total = parseFloat('@Model.CartTotal').toFixed(2);

                switch(method) {
                    case 'Cash':
                        submitBtn.html(`<i class="fas fa-lock"></i> Place Order - EGP ${total}`);
                        break;
                    case 'Instapay':
                        submitBtn.html(`<i class="fas fa-credit-card"></i> Pay with Instapay - EGP ${total}`);
                        break;
                    case 'Wallet':
                        submitBtn.html(`<i class="fas fa-wallet"></i> Pay with Wallet - EGP ${total}`);
                        break;
                }
            }

            // Initialize button text
            updateSubmitButton('Cash');

            // Add input validation styling
            $('.form-control').on('blur', function () {
                const $this = $(this);
                const $validationMessage = $this.next('.validation-message');

                if ($validationMessage.text().trim() !== '') {
                    $this.addClass('invalid');
                } else {
                    $this.removeClass('invalid');
                }
            });

            // Prevent form submission if there are validation errors
            $('#checkout-form').on('submit', function (e) {
                const $invalidFields = $('.form-control.invalid');
                if ($invalidFields.length > 0) {
                    e.preventDefault();
                    $('html, body').animate({
                        scrollTop: $invalidFields.first().offset().top - 100
                    }, 500);
                }
            });
        });
    </script>
}